<%# show_filters: :when_filtered %>
<%= grid(@tickets_grid) do |g|

  @now = Time.now

 # grid(@tickets_grid) do |g|

  g.row_attributes do |ticket|
    if ticket.priority.name == 'Severa'
      {class: 'text-danger'}
    end
  end

  g.column name:  'Espera', attribute: 'date', filter: false do |ticket|
    #ticket.date.to_formatted_s(:short)
    @a = ticket.situation_id
    if @a != 4
     "%02d:%02d:%02d:%02d" % [(@now - ticket.date)/86400, (@now - ticket.date)/3600%24, (@now - ticket.date)/60%60, (@now - ticket.date)%60]

      else
        "%02d:%02d:%02d:%02d" % [(0 - 0)/86400, (0)/3600%24, (0)/60%60, (0)%60]
      end
  end

  g.column name:  'ID', attribute: 'id', html: {style: 'text-align: center; width: auto '} do |ticket|
  link_to(ticket.id, edit_ticket_path(ticket))
  end
  
  g.column name:  'Fecha', attribute: 'date' do |ticket|
    ticket.date.to_s(:db)
    end


  #g.column  name:  'Usuario:', attribute: 'name', auto_reload: true, assoc: :user, custom_filter: :auto  do |ticket|
   # ticket.user.name if ticket.user
  #end

  g.column  name:  'Num. Cuenta', attribute: 'accnumber', assoc: :customer

  g.column  name:  'Cliente', attribute: 'name', assoc: :customer
  
 # g.column name:  'Contacto', attribute: 'contactName'
   
  g.column  name:  'Asignado a:', attribute: 'name', auto_reload: true, assoc: :employee, custom_filter: :auto  do |ticket|
    ticket.employee.name if ticket.employee
  end

  g.column name:  'Priority', attribute: 'name', auto_reload: true, assoc: :priority, custom_filter: :auto  do |ticket|
    ticket.priority.name if ticket.priority
  end

  g.column  name:  'Estatus', attribute: 'name', auto_reload: true, assoc: :situation, custom_filter: :auto  do |ticket|
    ticket.situation.name if ticket.situation
  end

 #http://localhost:3000/tickets.index?grid[f][situations.name][]=abierto
 # g.column  name:  'Categoria', attribute: 'name', auto_reload: true, assoc: :category, custom_filter: :auto  do |ticket|
  #  ticket.category.name if ticket.category
  #end
  
  g.column   do |ticket|
    link_to('Eliminar', ticket_path(ticket), data: {confirm: 'Esta seguro?'}, method: :delete)
  end




end -%>



<%= link_to 'Nuevo Ticket', new_ticket_path-%>

<script>
  $('#datepicker').datepicker({format: 'yyyy-mm-dd'});
</script>